// angular-slideshow - Copyright (c) 2015 by Daniel Schlessmann <info@eldanilo.de>
// License: http://www.opensource.org/licenses/mit-license.php

"use strict";angular.module("slideshow",[]).directive("slideshow",["$compile","$http","$timeout","$location",function(a,b,c,d){var e=function(b,c){var d=this;if(this.$scope=b,this.elem=c,this.handlers={onOrientationChange:function(a){d.handlers.onResize(a)},onResize:function(a){for(var b=0;b<d.$scope.slides.length;++b)"function"==typeof d.$scope.slides[b].resize&&d.$scope.slides[b].resize()},register:function(){"undefined"!=typeof window.orientation?window.addEventListener("orientationchange",this.onOrientationChange):window.addEventListener("resize",this.onResize)}},this.handlers.register(),this.animator={current:null,active:!1,timer:null,clearTimer:function(){},startTimer:function(){},loadSlide:function(a,b){this.active||(d.animator.active=!0,this.clearTimer(),d.$scope.slides[a].reset(),b||(d.$scope.slides[a].elem.style.left=0,d.$scope.slides[a].show()),this.startTimer(),this.current=a,this.active=!1)},handlers:{slideLoaded:function(a,b){b===d.animator.current&&d.animator.loadSlide(b)},register:function(){d.$scope.$on("slideLoaded",this.slideLoaded)}}},this.animator.handlers.register(),b.slides&&b.slides.length>0){this.animator.current=0;for(var e=0;e<b.slides.length;++e){var f=document.createElement("slide");f.setAttribute("data-slide-index",e),c.appendChild(f),a(f)(b)}}};return{restrict:"E",controller:["$scope",function(a){a.controller=this,a.slideshow=null,this.addSlide=function(b){"undefined"!=typeof b.index&&(a.slides[b.index]=b)}}],compile:function(a,b){return{pre:function(a,b,c,d){a.slideshow=new e(a,b[0])},post:function(a,b,c,d){}}},scope:{slides:"="}}}]).directive("slide",["$timeout","$http","$location",function(a,b,c){var d=function(a,b){this.slide=a,this.elem=b,this.isSVG="svg"===b.nodeName.toLowerCase()?!0:!1,this.isLoading=!0,this.width=JustJS.dom.outerWidth(b),this.height=JustJS.dom.outerHeight(b),this.preserveRatio=!1;var c="string"==typeof b.className?b.className.match(/(?:^|\s)preserve-ratio-(\d+)(?:$|\s)/):null;null!==c&&(this.preserveRatio=parseInt(c[1])/100),this.handlers={register:function(){}},this.handlers.register()};d.prototype.updateSize=function(a,b){this.isSVG?(this.elem.setAttribute("width",a+"px"),this.elem.setAttribute("height",b+"px")):(this.elem.style.width=a+"px",this.elem.style.height=b+"px")},d.prototype.reset=function(){JustJS.dom.hasClass(this.elem,"center")&&(this.elem.style.marginTop=-Math.ceil(JustJS.dom.outerHeight(this.elem)/2)+"px",this.elem.style.marginLeft=-Math.ceil(JustJS.dom.outerWidth(this.elem)/2)+"px")},d.prototype.resize=function(){if(null!==typeof this.slide.$scope.slideshow){var a=this.slide.$scope.slideshow,b=JustJS.dom.innerWidth(a.elem),c=JustJS.dom.innerHeight(a.elem),d=JustJS.dom.outerWidth(this.elem),e=JustJS.dom.outerHeight(this.elem),f=b/d,g=c/e,h=Math.ceil(d*(g>f?f:g)),i=Math.ceil(e*(g>f?f:g)),j=null,k=null;this.preserveRatio!==!1&&(j=Math.ceil(b*this.preserveRatio),k=Math.ceil(j*(this.height/this.width))),h>d&&(null!==j?j>d:!0)?(this.preserveRatio!==!1&&h>j&&(h=j,i=k),h>this.width&&(h=this.width,i=this.height),d<this.width&&(this.updateSize(h,i),this.reset())):(d>h||null!==j&&d>j)&&(this.preserveRatio!==!1&&h>j&&(h=j,i=k),this.updateSize(h,i),this.reset())}else console.log("Slideshow: no valid slideshow instance present to perform resize.")};var e=function(e,f){var g=this;if(this.$scope=e,this.elem=f,this.index=f.hasAttribute("data-slide-index")&&/^\d+$/.test(f.getAttribute("data-slide-index"))?parseInt(f.getAttribute("data-slide-index")):null,this.objects=[],this.loading=0,this.animator={},this.handlers={emitLoaded:function(){a(function(){g.$scope.controller.addSlide(g),g.$scope.$emit("slideLoaded",g.index)})},imageLoaded:function(a){g.elem.appendChild(a),g.objects.push(new d(g,a)),0===--g.loading&&g.handlers.emitLoaded()},svgLoaded:function(a,b){var e=document.createElement("svg");if(e.id="svg-"+b,e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.setAttribute("width",a.getAttribute("width")),e.setAttribute("height",a.getAttribute("height")),e.setAttribute("viewBox",a.getAttribute("viewBox")),a&&a.childNodes.length>0)for(var f=0;f<a.childNodes.length;)if(1===a.childNodes[f].nodeType){if(a.childNodes[f].style.clipPath&&""!==a.childNodes[f].style.clipPath){var h=a.childNodes[f].style.clipPath.match(/url\([\"\']?\#([^"')]+)["']?\)/);h&&(a.childNodes[f].style.clipPath="url("+c.url()+"#"+h[1]+")")}e.appendChild(a.childNodes[f])}else f++;for(var i=e.querySelectorAll("[fill^=url]"),f=0;f<i.length;++f){var h=i[f].getAttribute("fill").match(/url\([\"\']?\#([^"')]+)["']?\)/);h&&i[f].setAttribute("fill","url("+c.url()+"#"+h[1]+")")}g.elem.innerHTML+=e.outerHTML,e=g.elem.querySelector("#svg-"+b),null!==e&&(e.id="",g.objects.push(new d(g,e)),0===--g.loading&&g.handlers.emitLoaded())},register:function(){}},this.handlers.register(),null!==this.index&&e.slides[this.index].objects)for(var h=0;h<e.slides[this.index].objects.length;++h){var i=e.slides[this.index].objects[h];switch(i.type){case"img":++this.loading;var j=document.createElement("img");j.onload=function(){g.handlers.imageLoaded(j)},j.alt=i.alt,j.className=i.classes,j.src=i.src;break;case"svg":++this.loading,function(c,d){b.get(c.src,{cache:!0}).success(function(b){b=b.replace(/\<\?xml(.*?)\?\>|\<\!--(.*?)--\>|\<\!DOCTYPE([^\>]+)\>/gi,"").replace(/^\s+|\s+$/g,"");var c=document.createElement("div");c.innerHTML=b;var e=c.querySelector("svg");null!==e&&a(function(){g.handlers.svgLoaded(e,d)})})}(i,h)}}};return e.prototype.reset=function(){for(var a=0;a<this.objects.length;a++)this.objects[a].reset()},e.prototype.show=function(){},e.prototype.resize=function(){for(var a=0;a<this.objects.length;a++)this.objects[a].resize()},{restrict:"E",require:"^slideshow",controller:["$scope",function(a){}],compile:function(a,b){return{pre:function(a,b,c,d){},post:function(a,b,c,d){new e(a,b[0])}}}}}]);
//# sourceMappingURL=angular-slideshow.min.js.map