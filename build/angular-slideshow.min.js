// angular-slideshow - version 0.2.0 - copyright (c) 2015 by Daniel Schlessmann <info@eldanilo.de>
// License: http://www.opensource.org/licenses/mit-license.php

"use strict";angular.module("slideshow",[]).directive("slideshow",["$compile","$http","$timeout","$q","$location",function(a,b,c,d,e){var f=function(b,e){var f=this;if(this.$scope=b,this.elem=e,this.handlers={onOrientationChange:function(a){f.handlers.onResize(a)},onResize:function(a){for(var b=0;b<f.$scope.slides.length;++b)"function"==typeof f.$scope.slides[b].resize&&(f.$scope.slides[b].resize(),f.$scope.slides[b].elem.style.left=(b!==f.animator.current?-JustJS.dom.innerWidth(f.elem):0)+"px")},register:function(){"undefined"!=typeof window.orientation?window.addEventListener("orientationchange",this.onOrientationChange):window.addEventListener("resize",this.onResize)}},this.handlers.register(),this.animator={current:null,active:!1,timer:null,startTimer:function(){this.timer=c(function(){var a=f.animator.current,b=a<f.$scope.slides.length-1?++a:0;f.animator.loadSlide(b,!0)},3e3)},loadSlide:function(a,b){if(!this.active){f.animator.active=!0;var c=f.$scope.slides[this.current],e=f.$scope.slides[a],g=JustJS.dom.innerWidth(f.elem);if(0===e.elem.style.left)return;c.hide().then(function(){var h=d.defer(),i=function(){c.elem.style.left="",JustJS.dom.removeClass(c.elem,"active"),f.animator.current=a,JustJS.dom.addClass(e.elem,"active"),h.resolve()};return b?(e.elem.style.left=g+"px",JustJS.fx.animate(c.elem,{left:"-="+g},{duration:650,easing:"inQuad"}),JustJS.fx.animate(e.elem,{left:"-="+g},{duration:650,easing:"inQuad",complete:i})):(i(),e.elem.style.left="0px"),h.promise}).then(function(){return e.show()}).then(function(){f.animator.startTimer(),f.animator.active=!1})}},handlers:{slideLoaded:function(a,b){b===f.animator.current&&f.animator.loadSlide(b)},register:function(){f.$scope.$on("slideLoaded",this.slideLoaded)}}},this.animator.handlers.register(),b.slides&&b.slides.length>0){this.animator.current=0;for(var g=0;g<b.slides.length;++g){var h=document.createElement("slide");h.setAttribute("data-slide-index",g),e.appendChild(h),a(h)(b)}}};return f.prototype.destroy=function(){c.cancel(this.animator.timer);for(var a=0;a<this.$scope.slides.length;++a)this.$scope.slides[a].destroy()},{restrict:"E",controller:["$scope",function(a){a.controller=this,a.slideshow=null,this.addSlide=function(b){"undefined"!=typeof b.index&&(a.slides[b.index]=b)}}],compile:function(a,b){return{pre:function(a,b,c,d){a.slideshow=new f(a,b[0]),a.$on("$destroy",function(){a.slideshow.destroy()})},post:function(a,b,c,d){}}},scope:{slides:"="}}}]).directive("slide",["$timeout","$http","$location","$q",function(a,b,c,d){var e=function(a,b){this.slide=a,this.elem=b,this.isSVG="svg"===b.nodeName.toLowerCase()?!0:!1,this.isLoading=!0,this.width=JustJS.dom.outerWidth(b),this.height=JustJS.dom.outerHeight(b),this.preserveRatio=!1;var c="string"==typeof b.className?b.className.match(/(?:^|\s)preserve-ratio-(\d+)(?:$|\s)/):null;null!==c&&(this.preserveRatio=parseInt(c[1])/100),this.handlers={register:function(){}},this.handlers.register(),this.resize()};e.prototype.updateSize=function(a,b){this.isSVG?(this.elem.setAttribute("width",a+"px"),this.elem.setAttribute("height",b+"px")):(this.elem.style.width=a+"px",this.elem.style.height=b+"px")},e.prototype.adjustPosition=function(){JustJS.dom.hasClass(this.elem,"center")&&(this.elem.style.marginTop=-Math.ceil(JustJS.dom.outerHeight(this.elem)/2)+"px",this.elem.style.marginLeft=-Math.ceil(JustJS.dom.outerWidth(this.elem)/2)+"px")},e.prototype.reset=function(){this.adjustPosition();for(var a=this.elem.querySelectorAll(".fade-in"),b=0;b<a.length;b++)a[b].style.display="none";if(this.isSVG){for(var a=this.elem.querySelectorAll(".slide-in"),b=0;b<a.length;b++){var c=a[b].getBBox(),d=[0,0];switch(a[b].getAttribute("data-animation-slide-from")){case"top":d=[0,-Math.ceil(c.y+c.height+50)];break;case"right":d=[Math.ceil(this.width-c.x),0];break;case"bottom":break;case"left":}var e="translate("+d[0]+(0!==d[1]?" "+d[1]:"")+")",f=a[b].getAttribute("transform");if(f&&f.length>0){var g=f.match(/translate\((-?\d+(\.\d+)?)(px)?(([\,\s])(-?\d+)(\.\d+)?(px)?)?\)/i);a[b].setAttribute("transform",g?f.replace(g[0],e):f+" "+e)}else a[b].setAttribute("transform",e)}for(var a=this.elem.querySelectorAll(".translate"),b=0;b<a.length;b++)a[b].removeAttribute("transform")}},e.prototype.resize=function(){if(null!==typeof this.slide.$scope.slideshow){var a=this.slide.$scope.slideshow,b=JustJS.dom.innerWidth(a.elem),c=JustJS.dom.innerHeight(a.elem),d=JustJS.dom.outerWidth(this.elem),e=JustJS.dom.outerHeight(this.elem),f=b/d,g=c/e,h=Math.ceil(d*(g>f?f:g)),i=Math.ceil(e*(g>f?f:g)),j=null,k=null;this.preserveRatio!==!1&&(j=Math.ceil(b*this.preserveRatio),k=Math.ceil(j*(this.height/this.width))),h>d&&(null!==j?j>d:!0)?(this.preserveRatio!==!1&&h>j&&(h=j,i=k),h>this.width&&(h=this.width,i=this.height),d<this.width&&(this.updateSize(h,i),this.adjustPosition())):(d>h||null!==j&&d>j)&&(this.preserveRatio!==!1&&h>j&&(h=j,i=k),this.updateSize(h,i),this.adjustPosition())}else console.log("Slideshow: no valid slideshow instance present to perform resize.")};var f=function(f,g){var h=this;if(this.$scope=f,this.elem=g,this.index=g.hasAttribute("data-slide-index")&&/^\d+$/.test(g.getAttribute("data-slide-index"))?parseInt(g.getAttribute("data-slide-index")):null,this.objects=[],this.loading=0,this.animator={running:0,deferred:null,animations:[],show:function(){if(null===h.animator.deferred){h.animator.deferred=d.defer();var b=h.elem.querySelectorAll(".animate");if(b.length>0)for(var c=function(){--h.animator.running,0===h.animator.running&&(h.animator.deferred.resolve(),h.animator.deferred=null)},e=0,f=0;f<b.length;f++)JustJS.dom.hasClass(b[f],"fade-in")&&(h.animator.running++,function(b,d,f){h.animator.animations[e++]=a(function(){JustJS.fx.fadeIn(b,{duration:d>0?d:700,complete:c})},f)}(b[f],parseInt(b[f].getAttribute("data-animation-duration"),10),parseInt(b[f].getAttribute("data-animation-delay"),10))),JustJS.dom.hasClass(b[f],"slide-in")&&(h.animator.running++,function(b,d,f){h.animator.animations[e++]=a(function(){JustJS.fx.transform(b,{translate:{x:0,y:0}},{duration:d>0?d:700,easing:"backIn",useAttributes:!0,complete:c})},f)}(b[f],parseInt(b[f].getAttribute("data-animation-duration"),10),parseInt(b[f].getAttribute("data-animation-delay"),10))),JustJS.dom.hasClass(b[f],"translate")&&(h.animator.running++,function(b,d,f){var g=parseInt(b.getAttribute("data-animation-translate-x")),i=parseInt(b.getAttribute("data-animation-translate-y"));h.animator.animations[e++]=a(function(){JustJS.fx.transform(b,{translate:{x:g?g:0,y:i?i:0}},{duration:d>0?d:700,easing:"inQuad",useAttributes:!0,complete:c})},f)}(b[f],parseInt(b[f].getAttribute("data-animation-duration"),10),parseInt(b[f].getAttribute("data-animation-delay"),10)));else a(function(){h.animator.deferred.resolve(),h.animator.deferred=null});return h.animator.deferred.promise}},hide:function(){var b=d.defer();return a(function(){for(var a=0;a<h.objects.length;a++)h.objects[a].reset();b.resolve()}),b.promise},reset:function(){var b=d.defer();return a(function(){for(var a=0;a<h.objects.length;a++)h.objects[a].reset();b.resolve()}),b.promise}},this.handlers={emitLoaded:function(){h.reset(),a(function(){h.$scope.controller.addSlide(h),h.$scope.$emit("slideLoaded",h.index)})},imageLoaded:function(a){h.elem.appendChild(a),h.objects.push(new e(h,a)),0===--h.loading&&h.handlers.emitLoaded()},svgLoaded:function(a,b){var d=document.createElement("svg");if(d.id="svg-"+b,d.setAttribute("xmlns","http://www.w3.org/2000/svg"),d.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),d.setAttribute("width",a.getAttribute("width")),d.setAttribute("height",a.getAttribute("height")),d.setAttribute("viewBox",a.getAttribute("viewBox")),a&&a.childNodes.length>0)for(var f=0;f<a.childNodes.length;)if(1===a.childNodes[f].nodeType){if(a.childNodes[f].style.clipPath&&""!==a.childNodes[f].style.clipPath){var g=a.childNodes[f].style.clipPath.match(/url\([\"\']?\#([^"')]+)["']?\)/);g&&(a.childNodes[f].style.clipPath="url("+c.url()+"#"+g[1]+")")}d.appendChild(a.childNodes[f])}else f++;for(var i=d.querySelectorAll("[fill^=url]"),f=0;f<i.length;++f){var g=i[f].getAttribute("fill").match(/url\([\"\']?\#([^"')]+)["']?\)/);g&&i[f].setAttribute("fill","url("+c.url()+"#"+g[1]+")")}h.elem.innerHTML+=d.outerHTML,d=h.elem.querySelector("#svg-"+b),null!==d&&(d.id="",h.objects.push(new e(h,d)),0===--h.loading&&h.handlers.emitLoaded())},register:function(){}},this.handlers.register(),null!==this.index&&f.slides[this.index].objects)for(var i=0;i<f.slides[this.index].objects.length;++i){var j=f.slides[this.index].objects[i];switch(j.type){case"img":++this.loading;var k=document.createElement("img");k.onload=function(){h.handlers.imageLoaded(k)},k.alt=j.alt,k.className=j.classes,k.src=j.src;break;case"svg":++this.loading,function(c,d){b.get(c.src,{cache:!0}).success(function(b){b=b.replace(/\<\?xml(.*?)\?\>|\<\!--(.*?)--\>|\<\!DOCTYPE([^\>]+)\>/gi,"").replace(/^\s+|\s+$/g,"");var c=document.createElement("div");c.innerHTML=b;var e=c.querySelector("svg");null!==e&&a(function(){h.handlers.svgLoaded(e,d)})})}(j,i)}}};return f.prototype.reset=function(){return this.animator.reset()},f.prototype.show=function(){return this.animator.show()},f.prototype.hide=function(){return this.animator.hide()},f.prototype.resize=function(){for(var a=0;a<this.objects.length;a++)this.objects[a].resize()},f.prototype.destroy=function(){for(var b=0;b<this.animator.animations.length;b++)this.animator.animations[b]&&a.cancel(this.animator.animations[b])},{restrict:"E",require:"^slideshow",controller:["$scope",function(a){}],compile:function(a,b){return{pre:function(a,b,c,d){},post:function(a,b,c,d){new f(a,b[0])}}}}}]);
//# sourceMappingURL=angular-slideshow.min.js.map